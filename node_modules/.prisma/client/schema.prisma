generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  USER
}

enum UserType {
  COACH
  STUDENT
}

enum Sexo {
  MASCULINO
  FEMININO
  OUTRO
}

enum Plano {
  MENSAL
  TRIMESTRAL
  SEMESTRAL
  ANUAL
}

enum TipoPlano {
  TREINO
  DIETA
  FULL
}

enum Objetivo {
  PERDA_PESO
  HIPERTROFIA
  DEFINICAO
  SAUDE
  PERFORMANCE
  REABILITACAO
}

enum FrequenciaFotos {
  SEMANAL
  QUINZENAL
  MENSAL
}

enum RestriacaoAlimentar {
  VEGETARIANO
  VEGANO
  SEM_GLUTEN
  SEM_LACTOSE
  DIABETICO
  HIPERTENSO
  OUTRO
}

enum RestriacaoExercicio {
  LESAO_COLUNA
  LESAO_JOELHO
  LESAO_OMBRO
  LESAO_COTOVELO
  ARTRITE
  TENDINITE
  OUTRO
}

enum CategoriaAlimento {
  PROTEINA
  CARBOIDRATO
  GORDURA
  FRUTA
  VEGETAL
  LATICINIO
  OUTRO
}

enum UnidadeAlimento {
  GRAMAS
  MILILITROS
  UNIDADE
  COLHER
  XICARA
  PORCAO
}

enum GrupoMuscular {
  PEITO
  COSTAS
  PERNAS
  OMBROS
  BRACOS
  ABDOMEN
  GLUTEOS
  PANTURRILHA
  ANTEBRACO
  TRAPEZIO
  CORPO_INTEIRO
}

enum TipoExercicio {
  FORCA
  AEROBICO
  MOBILIDADE
  FLEXIBILIDADE
  FUNCIONAL
  CARDIO
}

enum CategoriaExercicio {
  INICIANTE
  INTERMEDIARIO
  AVANCADO
}

enum TipoSuplemento {
  SUPLEMENTO
  MANIPULADO
}

enum CategoriaSuplemento {
  TERMOGENICO
  PRE_TREINO
  HORMONAL
  ANTIOXIDANTE
  DIGESTIVO
  SONO
  VITAMINA
  MINERAL
  PROTEINA
  CREATINA
  BCAA
  OUTRO
}

enum MomentoSuplemento {
  PRE_TREINO
  POS_TREINO
  MANHA
  TARDE
  NOITE
  JEJUM
  REFEICAO
}

enum TipoHormonio {
  PEPTIDEO
  ESTEROIDE
  TIREOIDE
  CRESCIMENTO
  INSULINA
  CORTISOL
  TESTOSTERONA
  OUTRO
}

enum CategoriaHormonio {
  // Peptídeos
  GH_RELEASING
  INSULINA_LIKE
  PEPTIDEO_TERAPEUTICO

  // Esteroides
  ANABOLICO
  ANDROGENICO
  CORTICOSTEROIDE

  // Tireoide
  T3
  T4
  TSH

  // Crescimento
  SOMATOTROPINA
  IGF

  // Insulina
  RAPIDA
  LENTA
  INTERMEDIARIA

  // Outros
  MODULADOR_HORMONAL
  OUTRO
}

enum FrequenciaHormonio {
  DIARIA
  DIA_SIM_DIA_NAO
  DUAS_VEZES_SEMANA
  SEMANAL
  QUINZENAL
  MENSAL
  CONFORME_NECESSARIO
}

enum ViaAdministracao {
  SUBCUTANEA
  INTRAMUSCULAR
  ORAL
  TOPICA
  NASAL
  INTRAVENOSA
}

enum DuracaoUso {
  DUAS_SEMANAS
  QUATRO_SEMANAS
  SEIS_SEMANAS
  OITO_SEMANAS
  DOZE_SEMANAS
  DEZESSEIS_SEMANAS
  VINTE_SEMANAS
  CONTINUO
}

enum ProtocoloStatus {
  RASCUNHO
  ATIVO
  PAUSADO
  CONCLUIDO
}

model Aluno {
  id String @id @default(cuid())

  // Dados Pessoais
  nomeCompleto   String
  dataNascimento DateTime
  idade          Int
  sexo           Sexo
  altura         Float
  peso           Float
  email          String   @unique
  senha          String
  contato        String
  ativo          Boolean  @default(true)

  // Dados de Plano
  plano     Plano
  tipoPlano TipoPlano
  objetivo  Objetivo

  // Histórico e Restrições
  jaTreinava         Boolean @default(false)
  restricaoAlimentar String?
  restricaoExercicio String?
  historicoMedico    String?

  // Configuração
  frequenciaFotos FrequenciaFotos
  observacoes     String?

  // Timestamps e relacionamento
  dataCriacao     DateTime @default(now())
  dataAtualizacao DateTime @updatedAt

  // Relacionamento com coach que criou o aluno
  coach   User   @relation("CoachAlunos", fields: [coachId], references: [id], onDelete: Cascade)
  coachId String

  protocolos Protocolo[]

  @@map("alunos")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String // Added password field for bcrypt
  name      String?
  role      Role     @default(USER) // Added role field
  userType  UserType // Added userType field (COACH/STUDENT)
  avatar    String? // Added avatar field
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  alunos                Aluno[]        @relation("CoachAlunos")
  alimentos             Alimento[]     @relation("CoachAlimentos")
  exercicios            Exercicio[]    @relation("CoachExercicios")
  suplementos           Suplemento[]   @relation("CoachSuplementos")
  hormonios             Hormonio[]     @relation("CoachHormonios")
  notificationsSent     Notification[] @relation("NotificationSender")
  notificationsReceived Notification[] @relation("NotificationReceiver")
  coachProtocolos       Protocolo[]    @relation("CoachProtocolos")

  @@map("users")
}

model Protocolo {
  id                    String          @id @default(cuid())
  nome                  String // Ex: "Protocolo 1 - Hipertrofia"
  descricao             String?
  status                ProtocoloStatus @default(RASCUNHO)
  objetivo              String?
  dataCriacao           DateTime        @default(now())
  dataInicioPrevista    DateTime? // Para quando o Coach planeja iniciar
  dataAtivacao          DateTime? // Quando o status foi para ATIVO
  dataValidade          DateTime? // Data de expiração/revisão
  totalCalorico         Int?
  consumoAgua           String?
  regrasGeraisNutricao  String?
  proteinaPercentual    Int?
  carboidratoPercentual Int?
  gorduraPercentual     Int?
  // Relacionamentos com o Aluno
  aluno                 Aluno           @relation(fields: [alunoId], references: [id])
  alunoId               String

  // Relacionamentos com o Coach
  coach   User   @relation("CoachProtocolos", fields: [coachId], references: [id])
  coachId String

  // Relações com as partes do Plano (Dieta, Treino, etc.)
  refeicoes            Refeicao[] // Relação 1-para-Muitos com Refeições
  planosTreino         PlanoTreinoDivisao[] // Relação 1-para-Muitos com Divisões de Treino
  suplementosProtocolo SuplementoProtocolo[] // Relação 1-para-Muitos com Suplementos
  hormoniosProtocolo   HormonioProtocolo[] // Relação 1-para-Muitos com Hormônios

  @@map("protocolos")
}

// ------------------------------------
// 1. PLANO ALIMENTAR
// ------------------------------------

model Refeicao {
  id              String  @id @default(cuid())
  nomeRefeicao    String
  horarioPrevisto String?
  observacoes     String?

  // Relação com o Protocolo
  protocolo   Protocolo @relation(fields: [protocoloId], references: [id], onDelete: Cascade)
  protocoloId String

  // Relação com os alimentos daquela refeição
  alimentos AlimentoRefeicao[]

  @@map("refeicoes")
}

// Tabela de Junção (M-para-M) entre Alimento e Refeição
model AlimentoRefeicao {
  id            String  @id @default(cuid())
  quantidade    Float
  unidadeMedida String? // Ex: 'gramas', 'unidade', 'colher'
  observacoes   String? // Ex: "Opcional: troca por batata doce"

  // Relação com Alimento do Catálogo
  alimento   Alimento @relation(fields: [alimentoId], references: [id])
  alimentoId String

  // Relação com a Refeição
  refeicao   Refeicao @relation(fields: [refeicaoId], references: [id], onDelete: Cascade)
  refeicaoId String

  @@map("alimentos_refeicao")
}

// ------------------------------------
// 2. PLANO DE TREINO
// ------------------------------------

// Representa uma Divisão de Treino (Ex: "Treino A - Peito/Tríceps")
model PlanoTreinoDivisao {
  id            String  @id @default(cuid())
  nomeDivisao   String // Ex: "Treino A"
  grupoMuscular String? // Ex: "Peito e Tríceps"
  orientacoes   String?
  diaDaSemana   String? // Opcional: "Segunda-feira"

  // Relação com o Protocolo
  protocolo   Protocolo @relation(fields: [protocoloId], references: [id], onDelete: Cascade)
  protocoloId String

  // Relação com os Exercícios dessa divisão
  exercicios ExercicioTreino[]

  @@map("planos_treino_divisoes")
}

// Tabela de Junção (M-para-M) entre Exercicio e PlanoTreinoDivisao
model ExercicioTreino {
  id                String  @id @default(cuid())
  series            Int
  repeticoes        String // Ex: "3x10-12", "até a falha"
  carga             String? // Ex: "Progressiva"
  intervaloDescanso String? // Ex: "60 segundos"
  observacoes       String? // Ex: "Fazer drop-set na última série"
  ordem             Int // Ordem de execução do exercício

  // Relação com o Exercício do Catálogo
  exercicio   Exercicio @relation(fields: [exercicioId], references: [id], onDelete: Cascade)
  exercicioId String

  // Relação com a Divisão de Treino
  planoTreinoDivisao   PlanoTreinoDivisao @relation(fields: [planoTreinoDivisaoId], references: [id], onDelete: Cascade)
  planoTreinoDivisaoId String

  @@map("exercicios_treino")
}

// ------------------------------------
// 3. SUPLEMENTAÇÃO / MANIPULADOS / HORMÔNIOS
// Usamos a mesma estrutura de relação para os três, mas com modelos diferentes
// ------------------------------------

// SUPLEMENTOS E MANIPULADOS
model SuplementoProtocolo {
  id          String  @id @default(cuid())
  quantidade  String // Ex: "10g", "1 scoop"
  formaUso    String // Ex: "Pré-treino", "Junto com a refeição 2"
  observacoes String?

  // Relação com o Protocolo
  protocolo   Protocolo @relation(fields: [protocoloId], references: [id], onDelete: Cascade)
  protocoloId String

  // Relação com o Suplemento do Catálogo
  suplemento   Suplemento @relation(fields: [suplementoId], references: [id])
  suplementoId String

  @@map("suplementos_protocolo")
}

// HORMÔNIOS
model HormonioProtocolo {
  id               String  @id @default(cuid())
  dosagem          String // Ex: "200mg", "1ml"
  frequencia       String // Ex: "Semanal", "Dia sim, dia não"
  viaAdministracao String? // Replicamos a informação do catálogo aqui para flexibilidade
  observacoes      String?

  // Relação com o Protocolo
  protocolo   Protocolo @relation(fields: [protocoloId], references: [id], onDelete: Cascade)
  protocoloId String

  // Relação com o Hormônio do Catálogo
  hormonio   Hormonio @relation(fields: [hormonioId], references: [id])
  hormonioId String

  @@map("hormonios_protocolo")
}

model Notification {
  id        String   @id @default(cuid())
  title     String
  message   String
  read      Boolean  @default(false)
  createdAt DateTime @default(now())

  // Relacionamentos
  sender     User?   @relation("NotificationSender", fields: [senderId], references: [id])
  senderId   String?
  receiver   User    @relation("NotificationReceiver", fields: [receiverId], references: [id])
  receiverId String

  @@map("notifications")
}

model Alimento {
  id          String            @id @default(cuid())
  nome        String
  categoria   CategoriaAlimento
  observacoes String?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  coach             User               @relation("CoachAlimentos", fields: [coachId], references: [id])
  coachId           String
  alimentosRefeicao AlimentoRefeicao[]

  @@map("alimentos")
}

model Exercicio {
  id            String             @id @default(cuid())
  nomeExercicio String
  grupoMuscular GrupoMuscular
  tipoExercicio TipoExercicio
  categoria     CategoriaExercicio
  linkVideo     String?
  descricao     String?
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt

  // Relacionamento com coach que criou o exercício
  coach            User              @relation("CoachExercicios", fields: [coachId], references: [id])
  coachId          String
  exerciciosTreino ExercicioTreino[]

  @@map("exercicios")
}

model Suplemento {
  id               String              @id @default(cuid())
  nomeSuplemento   String?
  nomeManipulado   String?
  tipo             TipoSuplemento
  categoria        CategoriaSuplemento
  observacoes      String?
  contraindicacoes String?
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt

  // Relacionamento com coach que criou o suplemento
  coach      User                  @relation("CoachSuplementos", fields: [coachId], references: [id])
  coachId    String
  protocolos SuplementoProtocolo[]

  @@map("suplementos")
}

model Hormonio {
  id                String            @id @default(cuid())
  nomeHormonio      String
  tipo              TipoHormonio
  categoria         CategoriaHormonio
  viaAdministracao  ViaAdministracao
  observacoes       String?
  contraindicacoes  String?
  efeitosColaterais String?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt

  coach      User                @relation("CoachHormonios", fields: [coachId], references: [id])
  coachId    String
  protocolos HormonioProtocolo[]

  @@map("hormonios")
}
