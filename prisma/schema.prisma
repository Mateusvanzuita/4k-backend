generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  USER
}

enum UserType {
  COACH
  STUDENT
}

enum Sexo {
  MASCULINO
  FEMININO
  OUTRO
}

enum Plano {
  MENSAL
  TRIMESTRAL
  SEMESTRAL
  ANUAL
}

enum TipoPlano {
  TREINO
  DIETA
  FULL
}

enum Objetivo {
  PERDA_PESO
  HIPERTROFIA
  DEFINICAO
  SAUDE
  PERFORMANCE
  REABILITACAO
}

enum FrequenciaFotos {
  SEMANAL
  QUINZENAL
  MENSAL
}

enum RestriacaoAlimentar {
  VEGETARIANO
  VEGANO
  SEM_GLUTEN
  SEM_LACTOSE
  DIABETICO
  HIPERTENSO
  OUTRO
}

enum RestriacaoExercicio {
  LESAO_COLUNA
  LESAO_JOELHO
  LESAO_OMBRO
  LESAO_COTOVELO
  ARTRITE
  TENDINITE
  OUTRO
}

enum CategoriaAlimento {
  PROTEINA
  CARBOIDRATO
  GORDURA
  FRUTA
  VEGETAL
  LATICINIO
  OUTRO
}

enum UnidadeAlimento {
  GRAMAS
  MILILITROS
  UNIDADE
  COLHER
  XICARA
  PORCAO
}

enum GrupoMuscular {
  PEITO
  COSTAS
  PERNAS
  OMBROS
  BICEPS
  TRICEPS
  ABDOMEN
  GLUTEOS
  PANTURRILHA
  ANTEBRACO
  TRAPEZIO
  CORPO_INTEIRO
}

enum TipoExercicio {
  FORCA
  AEROBICO
  MOBILIDADE
  FLEXIBILIDADE
  FUNCIONAL
  CARDIO
}

enum CategoriaExercicio {
  INICIANTE
  INTERMEDIARIO
  AVANCADO
}

enum TipoSuplemento {
  SUPLEMENTO
  MANIPULADO
}

enum CategoriaSuplemento {
  TERMOGENICO
  PRE_TREINO
  HORMONAL
  ANTIOXIDANTE
  DIGESTIVO
  SONO
  VITAMINA
  MINERAL
  PROTEINA
  CREATINA
  BCAA
  OUTRO
}

enum MomentoSuplemento {
  PRE_TREINO
  POS_TREINO
  MANHA
  TARDE
  NOITE
  JEJUM
  REFEICAO
}

enum TipoHormonio {
  PEPTIDEO
  ESTEROIDE
  TIREOIDE
  CRESCIMENTO
  INSULINA
  CORTISOL
  TESTOSTERONA
  OUTRO
}

enum CategoriaHormonio {
  // Pept√≠deos
  GH_RELEASING
  INSULINA_LIKE
  PEPTIDEO_TERAPEUTICO
  
  // Esteroides
  ANABOLICO
  ANDROGENICO
  CORTICOSTEROIDE
  
  // Tireoide
  T3
  T4
  TSH
  
  // Crescimento
  SOMATOTROPINA
  IGF
  
  // Insulina
  RAPIDA
  LENTA
  INTERMEDIARIA
  
  // Outros
  MODULADOR_HORMONAL
  OUTRO
}

enum FrequenciaHormonio {
  DIARIA
  DIA_SIM_DIA_NAO
  DUAS_VEZES_SEMANA
  SEMANAL
  QUINZENAL
  MENSAL
  CONFORME_NECESSARIO
}

enum ViaAdministracao {
  SUBCUTANEA
  INTRAMUSCULAR
  ORAL
  TOPICA
  NASAL
  INTRAVENOSA
}

enum DuracaoUso {
  DUAS_SEMANAS
  QUATRO_SEMANAS
  SEIS_SEMANAS
  OITO_SEMANAS
  DOZE_SEMANAS
  DEZESSEIS_SEMANAS
  VINTE_SEMANAS
  CONTINUO
}

enum ProtocoloStatus {
  RASCUNHO
  ATIVO
  PAUSADO
  CONCLUIDO
}

model Aluno {
  id                    String                  @id @default(cuid())
  
  // Dados Pessoais
  nomeCompleto          String
  dataNascimento        DateTime
  idade                 Int
  sexo                  Sexo
  altura                Float                 
  peso                  Float                 
  email                 String                  @unique
  senha                 String
  contato               String                  
  ativo                 Boolean                 @default(true)
  
  // Dados de Plano
  plano                 Plano
  tipoPlano             TipoPlano
  objetivo              Objetivo
  
  // Hist√≥rico e Restri√ß√µes
  jaTreinava            Boolean                 @default(false)
  restricaoAlimentar    String?
  restricaoExercicio    String?
  historicoMedico       String?
  primeiroAcesso        Boolean                 @default(false)
  
  // Configura√ß√£o
  frequenciaFotos       FrequenciaFotos
  observacoes           String?
  
  // Timestamps e relacionamento
  dataCriacao           DateTime                @default(now())
  dataAtualizacao       DateTime                @updatedAt
  pushSubscription Json?
  // Relacionamento com coach que criou o aluno
  coach                 User                    @relation("CoachAlunos", fields: [coachId], references: [id], onDelete: Cascade)
  coachId               String
  registrosEvolucao RegistroEvolucao[]
  notifications Notification[]
  protocolos Protocolo[]

  @@map("alunos")
}

model User {
  id            String   @id @default(cuid())
  email         String   @unique
  password      String                        // Added password field for bcrypt
  name          String?
  role          Role     @default(USER)       // Added role field
  userType      UserType                      // Added userType field (COACH/STUDENT)
  avatar        String?                       // Added avatar field
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  pushSubscription Json?
  
  alunos            Aluno[]         @relation("CoachAlunos")
  alimentos         Alimento[]      @relation("CoachAlimentos")
  exercicios        Exercicio[]     @relation("CoachExercicios")
  suplementos       Suplemento[]    @relation("CoachSuplementos")
  hormonios         Hormonio[]      @relation("CoachHormonios")
  notificationsSent Notification[]  @relation("NotificationSender")
  notificationsReceived Notification[] @relation("NotificationReceiver")
  coachProtocolos   Protocolo[]     @relation("CoachProtocolos")

  @@map("users")
}

model RegistroEvolucao {
  id          String   @id @default(cuid())
  dataCriacao DateTime @default(now())
  peso        Float
  observacao  String?
  
  alunoId     String
  aluno       Aluno    @relation(fields: [alunoId], references: [id], onDelete: Cascade)
  
  fotos       FotoEvolucao[]

  @@map("registros_evolucao")
}

model FotoEvolucao {
  id                 String   @id @default(cuid())
  url                String   // Caminho do arquivo no disco
  registroEvolucaoId String
  registro           RegistroEvolucao @relation(fields: [registroEvolucaoId], references: [id], onDelete: Cascade)

  @@map("fotos_evolucao")
}

model Protocolo {
  id                    String              @id @default(cuid())
  nome                  String              // Ex: "Protocolo 1 - Hipertrofia"
  descricao             String?
  status                ProtocoloStatus     @default(RASCUNHO)
  objetivo              String?
  dataCriacao           DateTime            @default(now())
  dataInicioPrevista    DateTime?           // Para quando o Coach planeja iniciar
  dataAtivacao          DateTime?           // Quando o status foi para ATIVO
  dataValidade          DateTime?           // Data de expira√ß√£o/revis√£o
  totalCalorico         Int?
  consumoAgua           String?
  regrasGeraisNutricao  String?
  proteinaPercentual    Int?
  carboidratoPercentual Int?
  gorduraPercentual     Int?
  // Relacionamentos com o Aluno
  aluno                 Aluno               @relation(fields: [alunoId], references: [id])
  alunoId               String              

  // Relacionamentos com o Coach
  coach                 User                @relation("CoachProtocolos", fields: [coachId], references: [id])
  coachId               String

  // Rela√ß√µes com as partes do Plano (Dieta, Treino, etc.)
  refeicoes             Refeicao[]          // Rela√ß√£o 1-para-Muitos com Refei√ß√µes
  planosTreino          PlanoTreinoDivisao[]// Rela√ß√£o 1-para-Muitos com Divis√µes de Treino
  suplementosProtocolo  SuplementoProtocolo[] // Rela√ß√£o 1-para-Muitos com Suplementos
  hormoniosProtocolo    HormonioProtocolo[]   // Rela√ß√£o 1-para-Muitos com Horm√¥nios

  @@map("protocolos")
}

// ------------------------------------
// 1. PLANO ALIMENTAR
// ------------------------------------

model Refeicao {
  id              String         @id @default(cuid())
  nomeRefeicao    String
  horarioPrevisto String?
  observacoes     String?

  // Rela√ß√£o com o Protocolo
  protocolo       Protocolo      @relation(fields: [protocoloId], references: [id], onDelete: Cascade)
  protocoloId     String

  // Rela√ß√£o com os alimentos daquela refei√ß√£o
  alimentos       AlimentoRefeicao[]

  @@map("refeicoes")
}

// Tabela de Jun√ß√£o (M-para-M) entre Alimento e Refei√ß√£o
model AlimentoRefeicao {
  id              String        @id @default(cuid())
  quantidade      Float
  unidadeMedida   String?       // Ex: 'gramas', 'unidade', 'colher'
  observacoes     String?       // Ex: "Opcional: troca por batata doce"

  // Rela√ß√£o com Alimento do Cat√°logo
  alimento        Alimento      @relation(fields: [alimentoId], references: [id])
  alimentoId      String

  // Rela√ß√£o com a Refei√ß√£o
  refeicao        Refeicao      @relation(fields: [refeicaoId], references: [id], onDelete: Cascade)
  refeicaoId      String

  @@map("alimentos_refeicao")
}

// ------------------------------------
// 2. PLANO DE TREINO
// ------------------------------------

// Representa uma Divis√£o de Treino (Ex: "Treino A - Peito/Tr√≠ceps")
model PlanoTreinoDivisao {
  id              String            @id @default(cuid())
  nomeDivisao     String            // Ex: "Treino A"
  grupoMuscular   String?           // Ex: "Peito e Tr√≠ceps"
  orientacoes     String?
  diaDaSemana     String?           // Opcional: "Segunda-feira"

  // Rela√ß√£o com o Protocolo
  protocolo       Protocolo         @relation(fields: [protocoloId], references: [id], onDelete: Cascade)
  protocoloId     String

  // Rela√ß√£o com os Exerc√≠cios dessa divis√£o
  exercicios      ExercicioTreino[]

  @@map("planos_treino_divisoes")
}

// Tabela de Jun√ß√£o (M-para-M) entre Exercicio e PlanoTreinoDivisao
model ExercicioTreino {
  id                      String                @id @default(cuid())
  series                  Int
  repeticoes              String                // Ex: "3x10-12", "at√© a falha"
  carga                   String?               // Ex: "Progressiva"
  intervaloDescanso       String?               // Ex: "60 segundos"
  observacoes             String?               // Ex: "Fazer drop-set na √∫ltima s√©rie"
  ordem                   Int                   // Ordem de execu√ß√£o do exerc√≠cio

  // Rela√ß√£o com o Exerc√≠cio do Cat√°logo
  exercicio               Exercicio             @relation(fields: [exercicioId], references: [id], onDelete: Cascade)
  exercicioId             String

  // Rela√ß√£o com a Divis√£o de Treino
  planoTreinoDivisao      PlanoTreinoDivisao    @relation(fields: [planoTreinoDivisaoId], references: [id], onDelete: Cascade)
  planoTreinoDivisaoId    String

  @@map("exercicios_treino")
}

// ------------------------------------
// 3. SUPLEMENTA√á√ÉO / MANIPULADOS / HORM√îNIOS
// Usamos a mesma estrutura de rela√ß√£o para os tr√™s, mas com modelos diferentes
// ------------------------------------

// SUPLEMENTOS E MANIPULADOS
model SuplementoProtocolo {
  id                String       @id @default(cuid())
  quantidade        String       // Ex: "10g", "1 scoop"
  formaUso          String       // Ex: "Pr√©-treino", "Junto com a refei√ß√£o 2"
  observacoes       String?

  // Rela√ß√£o com o Protocolo
  protocolo         Protocolo    @relation(fields: [protocoloId], references: [id], onDelete: Cascade)
  protocoloId       String

  // Rela√ß√£o com o Suplemento do Cat√°logo
  suplemento        Suplemento   @relation(fields: [suplementoId], references: [id])
  suplementoId      String

  @@map("suplementos_protocolo")
}

// HORM√îNIOS
model HormonioProtocolo {
  id                String       @id @default(cuid())
  dosagem           String       // Ex: "200mg", "1ml"
  frequencia        String       // Ex: "Semanal", "Dia sim, dia n√£o"
  viaAdministracao  String?      // Replicamos a informa√ß√£o do cat√°logo aqui para flexibilidade
  observacoes       String?

  // Rela√ß√£o com o Protocolo
  protocolo         Protocolo    @relation(fields: [protocoloId], references: [id], onDelete: Cascade)
  protocoloId       String

  // Rela√ß√£o com o Horm√¥nio do Cat√°logo
  hormonio          Hormonio     @relation(fields: [hormonioId], references: [id])
  hormonioId        String

  @@map("hormonios_protocolo")
}

model Notification {
  id        String   @id @default(cuid())
  title     String
  message   String
  read      Boolean  @default(false)
  createdAt DateTime @default(now())

  // üîπ Quem ENVIOU (sempre User)
  sender   User?   @relation("NotificationSender", fields: [senderId], references: [id])
  senderId String?

  // üîπ Quem RECEBEU como User (opcional)
  receiverUser   User?  @relation("NotificationReceiver", fields: [receiverUserId], references: [id])
  receiverUserId String?

  // üîπ Quem RECEBEU como Aluno (opcional)
  receiverAluno   Aluno? @relation(fields: [receiverAlunoId], references: [id])
  receiverAlunoId String?

  @@map("notifications")
}

model Alimento {
  id          String            @id @default(cuid())
  nome        String
  categoria   CategoriaAlimento
  observacoes String?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  coach   User   @relation("CoachAlimentos", fields: [coachId], references: [id])
  coachId String
  alimentosRefeicao AlimentoRefeicao[]

  @@map("alimentos")
}

model Exercicio {
  id             String             @id @default(cuid())
  nomeExercicio  String
  grupoMuscular  GrupoMuscular
  tipoExercicio  TipoExercicio
  categoria      CategoriaExercicio
  linkVideo      String?
  descricao      String?
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt

  // Relacionamento com coach que criou o exerc√≠cio
  coach   User   @relation("CoachExercicios", fields: [coachId], references: [id])
  coachId String
  exerciciosTreino ExercicioTreino[]

  @@map("exercicios")
}

model Suplemento {
  id                String              @id @default(cuid())
  nomeSuplemento    String?
  nomeManipulado    String?
  tipo              TipoSuplemento
  categoria         CategoriaSuplemento
  observacoes       String?
  contraindicacoes  String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  // Relacionamento com coach que criou o suplemento
  coach   User   @relation("CoachSuplementos", fields: [coachId], references: [id])
  coachId String
  protocolos SuplementoProtocolo[]

  @@map("suplementos")
}

model Hormonio {
  id                  String             @id @default(cuid())
  nomeHormonio        String
  tipo                TipoHormonio
  categoria           CategoriaHormonio
  viaAdministracao    ViaAdministracao
  observacoes         String?
  contraindicacoes    String?
  efeitosColaterais   String?
  createdAt           DateTime           @default(now())
  updatedAt           DateTime           @updatedAt

  coach   User   @relation("CoachHormonios", fields: [coachId], references: [id])
  coachId String
  protocolos HormonioProtocolo[]

  @@map("hormonios")
}
